<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>首页 - 光年(Light Year Admin)后台管理系统模板</title>
<link rel="icon" href="favicon.ico" type="image/ico">
<meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
<meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
<meta name="author" content="yinqi">
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/materialdesignicons.min.css" rel="stylesheet">
<link href="../css/style.min.css" rel="stylesheet">
<link rel="stylesheet" href="../js/jconfirm/jquery-confirm.min.css">
<style type="text/css">
td{    text-align:center;valign:center}
.box{
	float:left;
	display:inline-block;
}
.name{
	position:
}
.hiden{
	display:none;
}
.shadow{
            transition-duration: 0.5s; //停留时间显示
        }
.shadow:hover{
            -webkit-box-shadow: #ccc 0px 10px 10px;
            -moz-box-shadow: #ccc 0px 10px 10px;
            box-shadow: #ccc 0px 10px 10px;  }
.shadow:hover button{
            	display:block;
            }
</style>
</head>
  
<body>
<div id="outerdiv" style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:2;width:100%;height:100%;display:none;">
        <div id="innerdiv" style="position:absolute;">
        	 <img id="bigimg" style="border:5px solid #fff;" src="" />
   		</div>
</div>
<div class="lyear-layout-web">

  <div class="lyear-layout-container">
   <!--左侧导航-->
    <aside class="lyear-layout-sidebar">
      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="index.html"><img src="../images/logo-sidebar.png" title="LightYear" alt="LightYear" /></a>
      </div>
      <div class="lyear-layout-sidebar-scroll"> 
        
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item active"> <a href="../index.html"><i class="mdi mdi-home"></i> 后台首页</a> </li>
            <li class="nav-item nav-item-has-subnav">
               <a href="javascript:void(0)"><i class="mdi mdi-account"></i>用户管理</a>
              <ul class="nav nav-subnav">
              	<!-- <li> <a href="user/addUser.html">添加用户</a> </li> -->
                <li> <a href="../user/showUsers.html">查看用户</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-comment-multiple-outline"></i>社区公告</a>
              <ul class="nav nav-subnav">
                <li > <a href="../notice/showNotice.html">查看公告</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
               <a href="javascript:void(0)"><i class="mdi mdi-source-fork"></i>故障保修</a>
              <ul class="nav nav-subnav">
                <li> <a href="../repair/showRepair.html">查看故障</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-square-inc-cash"></i>用户缴费</a>
              <ul class="nav nav-subnav">
                <li> <a href="../pay/showPays.html">缴费订单</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav open">
              <a href="javascript:void(0)"><i class="mdi mdi-camera-iris"></i>说说管理</a>
              <ul class="nav nav-subnav">
                <li class="active"> <a href="showTalks.html">查看说说</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-cart"></i>商品管理</a>
              <ul class="nav nav-subnav">
                <li> <a href="../product/showProduct.html">查看产品</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-city"></i>房屋管理</a>
                <ul class="nav nav-subnav">
                <li> <a href="../rent/showHouse.html">查看房源</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-content-paste"></i>订单管理</a>
                <ul class="nav nav-subnav">
                <li> <a href="../order/showOrder.html">查看订单</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-account-check"></i>用户认证</a>
                <ul class="nav nav-subnav">
                <li> <a href="../auth/authShow.html">查看</a> </li>
              </ul>
            </li>
          </ul>
        </nav>
        
        <div class="sidebar-footer">
          <p class="copyright">Copyright &copy; 2019. <a target="_blank" href="http://lyear.itshubao.com">IT书包</a> All rights reserved. More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></p>
        </div>
      </div>
      
    </aside>
    <!--End 左侧导航-->
    
    <!--头部信息-->
    <header class="lyear-layout-header">
      
      <nav class="navbar navbar-default">
        <div class="topbar">
          
          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title">说说</span>
          </div>
          
          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <img class="img-avatar img-avatar-48 m-r-10" src="../images/users/avatar.jpg" alt="笔下光年" />
                <span>笔下光年 <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> 个人信息</a> </li>
                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> 修改密码</a> </li>
                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> 清空缓存</a></li>
                <li class="divider"></li>
                <li> <a href="lyear_pages_login.html"><i class="mdi mdi-logout-variant"></i> 退出登录</a> </li>
              </ul>
            </li>
            <!--切换主题配色-->
		    <li class="dropdown dropdown-skin">
			  <span data-toggle="dropdown" class="icon-palette"><i class="mdi mdi-palette"></i></span>
			  <ul class="dropdown-menu dropdown-menu-right" data-stopPropagation="true">
                <li class="drop-title"><p>主题</p></li>
                <li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="site_theme" value="default" id="site_theme_1" checked>
                    <label for="site_theme_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="dark" id="site_theme_2">
                    <label for="site_theme_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="translucent" id="site_theme_3">
                    <label for="site_theme_3"></label>
                  </span>
                </li>
			    <li class="drop-title"><p>LOGO</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="logo_bg" value="default" id="logo_bg_1" checked>
                    <label for="logo_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_2" id="logo_bg_2">
                    <label for="logo_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_3" id="logo_bg_3">
                    <label for="logo_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_4" id="logo_bg_4">
                    <label for="logo_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_5" id="logo_bg_5">
                    <label for="logo_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_6" id="logo_bg_6">
                    <label for="logo_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_7" id="logo_bg_7">
                    <label for="logo_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_8" id="logo_bg_8">
                    <label for="logo_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>头部</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="header_bg" value="default" id="header_bg_1" checked>
                    <label for="header_bg_1"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_2" id="header_bg_2">
                    <label for="header_bg_2"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_3" id="header_bg_3">
                    <label for="header_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_4" id="header_bg_4">
                    <label for="header_bg_4"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_5" id="header_bg_5">
                    <label for="header_bg_5"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_6" id="header_bg_6">
                    <label for="header_bg_6"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_7" id="header_bg_7">
                    <label for="header_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_8" id="header_bg_8">
                    <label for="header_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>侧边栏</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="sidebar_bg" value="default" id="sidebar_bg_1" checked>
                    <label for="sidebar_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_2" id="sidebar_bg_2">
                    <label for="sidebar_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_3" id="sidebar_bg_3">
                    <label for="sidebar_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_4" id="sidebar_bg_4">
                    <label for="sidebar_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_5" id="sidebar_bg_5">
                    <label for="sidebar_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_6" id="sidebar_bg_6">
                    <label for="sidebar_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_7" id="sidebar_bg_7">
                    <label for="sidebar_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_8" id="sidebar_bg_8">
                    <label for="sidebar_bg_8"></label>
                  </span>
				</li>
			  </ul>
			</li>
            <!--切换主题配色-->
          </ul>
          
        </div>
      </nav>
      
    </header>
    <!--End 头部信息-->
    
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">
      
      <div class="container-fluid" id="allSS">
        	
      </div>
    </main>
    <!--End 页面主要内容-->
  </div>
</div>

<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="../js/main.min.js"></script>
<script src="../js/jconfirm/jquery-confirm.min.js"></script>
<script type="text/javascript" src="../js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="../js/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="../js/lightyear.js"></script>
<script type="text/javascript" src="../js/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="../js/lightyear.js"></script>
<script type="text/javascript">
$(document).ready(function(e) {
	//获取所有的说说
	 getAllTalk();
});
function test(photo){
	// var _test=$('figcaption').prev();
	 console.log(photo.path);
     imgShow("#outerdiv", "#innerdiv", "#bigimg", photo.path);  
}
function getAllTalk(){
	$.ajax({
		url: 'ssAction_findAllTalks.action',
		data:null,
		dataType: 'json',
		type: 'post',
		success:function(result){
			if(result.success){
					var lastName = "";
					//成功获取数据
					 $.each(result.ss,function (i,ss) {
						 var objSS=JSON.stringify(ss);
						 if(ss.user.name!=null){
							 lastName = ss.user.name;
						 }
						 var _div ="";
						 _div+="<div class='row' id='ss'>";
						 _div+="<div class='col-lg-12'>";
						 _div+="<div class='card'>";
						 _div+="<div class='card-toolbar clearfix shadow'>";
						 _div+="<div>";
						 _div+="<div class='box'>"
				         _div+="<img class='img-avatar img-avatar-48 m-r-10' src='../images/users/avatar.jpg' alt='' />";      
				         _div+="</div>";
				         _div+="<div>";
				         if(!ss.user.name){
				        	 _div+="<div><span id='name'>"+lastName+"</span></div>"
				         }else{
				        	 _div+="<div><span id='name'>"+ss.user.name+"</span></div>"
				         }
						 _div+="<div id='datetime' style='margin-top:10px'><span>"+ss.time+"</span></div>";	
						 _div+="</div>";			
						 _div+="</div>";
				         _div+=" <div style='margin:23px;' id='content'>"+ss.ssContent+"</div>";
				         _div+="<div style='margin:10px;'>"    
				         _div+="<div class='form-group col-md-12'>"  
				         _div+="<div class='form-controls'>";
				         /* 如果用户说说中包含图片 */
				         _div+="<ul class='list-inline clearfix lyear-uploads-pic' id='"+ss.sid+"'>";
				         _div+="</ul><button class='btn btn-danger hiden' onclick='test("+objSS+")' style='margin-top:6px;'><i class='mdi mdi-window-close'></i>删除</button></div></div></div></div></div></div></div>";      
				         $('#allSS').append(_div);
				         if(ss.ssImgs.length>0){
				        	 $.each(ss.ssImgs,function (i,photo) {
								 var test=JSON.stringify(photo);
								 var li="";
								 li+="<li class='col-xs-4 col-sm-3 col-md-2'>";
								 li +="<figure>";
								 li +="<img src='"+photo.path+"' alt='图片一' width='200px' height='200px'>";
								 li +="<figcaption onclick='bigImg("+test+")'><a class='btn btn-round btn-square btn-primary'><i class='mdi mdi-eye'></i></a> </figcaption>"
								 li +="</figure>"
								 li +="</li>";
								 var str = "#"+ss.sid;
								$(str).append(li);
							 });
				         }
					 });
			}else{
				alert("说说数据获取失败");
			}	
		}
	}); 
}
function bigImg(photo){
	// var _test=$('figcaption').prev();
	 console.log(photo.path);
     imgShow("#outerdiv", "#innerdiv", "#bigimg", photo.path);  
}
function imgShow(outerdiv, innerdiv, bigimg,src){  
    //var src = _this.attr("src");//获取当前点击的pimg元素中的src属性  
    $(bigimg).attr("src", src);//设置#bigimg元素的src属性  
        /*获取当前点击图片的真实大小，并显示弹出层及大图*/  
    $("<img/>").attr("src", src).load(function(){  
        var windowW = $(window).width();//获取当前窗口宽度  
        var windowH = $(window).height();//获取当前窗口高度  
        var realWidth = this.width;//获取图片真实宽度  
        var realHeight = this.height;//获取图片真实高度  
        var imgWidth, imgHeight;  
        var scale = 0.8;//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放  
          
        if(realHeight>windowH*scale) {//判断图片高度  
            imgHeight = windowH*scale;//如大于窗口高度，图片高度进行缩放  
            imgWidth = imgHeight/realHeight*realWidth;//等比例缩放宽度  
            if(imgWidth>windowW*scale) {//如宽度扔大于窗口宽度  
                imgWidth = windowW*scale;//再对宽度进行缩放  
            }  
        } else if(realWidth>windowW*scale) {//如图片高度合适，判断图片宽度  
            imgWidth = windowW*scale;//如大于窗口宽度，图片宽度进行缩放  
                        imgHeight = imgWidth/realWidth*realHeight;//等比例缩放高度  
        } else {//如果图片真实高度和宽度都符合要求，高宽不变  
            imgWidth = realWidth;  
            imgHeight = realHeight;  
        }  
                $(bigimg).css("width",imgWidth);//以最终的宽度对图片缩放  
          
        var w = (windowW-imgWidth)/2;//计算图片与窗口左边距  
        var h = (windowH-imgHeight)/2;//计算图片与窗口上边距  
        $(innerdiv).css({"top":h, "left":w});//设置#innerdiv的top和left属性  
        $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg  
    });  
      
    $(outerdiv).click(function(){//再次点击淡出消失弹出层  
        $(this).fadeOut("fast");  
    });  
}  
function getRanNum(){
	var str="";
     for(var i=0;i<4;i++){
        var ranNum = Math.ceil(Math.random() * 25); //生成一个0到25的数字
         //大写字母'A'的ASCII是65,A~Z的ASCII码就是65 + 0~25;然后调用String.fromCharCode()传入ASCII值返回相应的字符并push进数组里
         str+=String.fromCharCode(65+ranNum);
     }
  return  str;
 }
function test(ss){
	var removeSS = new Object();
	removeSS.sid = ss.sid;
	$.ajax({
		url: 'ssAction_removeSS.action',
		data:removeSS,
		dataType: 'json',
		type: 'post',
		success:function(result){
			if(result.success){
				lightyear.loading('show');
			    setTimeout(function() {
			        lightyear.loading('hide');
			        lightyear.notify('更新成功,正在自动跳转~', 'success', 1000);
			        setTimeout(function(){
			        	location.href="showTalks.html";
			        },3000)
			    }, 1e3)	
			}else{
				alert("说说数据获取失败");
			}	
		}
	}); 
}
</script>
</body>
</html>